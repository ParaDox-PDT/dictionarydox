# Build settings
[build]
  publish = "build/web"
  command = """
    # Disable secrets scanning
    export SECRETS_SCAN_ENABLED=false
    
    # Create .env file from environment variables
    echo "FIREBASE_WEB_API_KEY=$FIREBASE_WEB_API_KEY" > .env
    echo "FIREBASE_WEB_APP_ID=$FIREBASE_WEB_APP_ID" >> .env
    echo "FIREBASE_WEB_MESSAGING_SENDER_ID=$FIREBASE_WEB_MESSAGING_SENDER_ID" >> .env
    echo "FIREBASE_WEB_PROJECT_ID=$FIREBASE_WEB_PROJECT_ID" >> .env
    echo "FIREBASE_WEB_AUTH_DOMAIN=$FIREBASE_WEB_AUTH_DOMAIN" >> .env
    echo "FIREBASE_WEB_STORAGE_BUCKET=$FIREBASE_WEB_STORAGE_BUCKET" >> .env
    echo "FIREBASE_WEB_MEASUREMENT_ID=$FIREBASE_WEB_MEASUREMENT_ID" >> .env
    echo "PEXELS_API_KEY=$PEXELS_API_KEY" >> .env
    echo "DICTIONARY_API_BASE_URL=https://api.dictionaryapi.dev/api/v2/entries/en" >> .env
    
    # Install Flutter
    git clone https://github.com/flutter/flutter.git -b stable --depth 1
    export PATH="$PATH:`pwd`/flutter/bin"
    flutter config --no-analytics
    flutter doctor -v
    
    # Build the app
    flutter pub get
    dart run build_runner build --delete-conflicting-outputs
    flutter build web --release
  """

# Redirect rules for Flutter web routing
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# Headers for security and performance
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer"
    Permissions-Policy = "interest-cohort=()"

# Cache static assets
[[headers]]
  for = "/assets/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
